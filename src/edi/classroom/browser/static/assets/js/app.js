(function(e){function t(t){for(var s,i,c=t[0],o=t[1],l=t[2],d=0,h=[];d<c.length;d++)i=c[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&h.push(r[i][0]),r[i]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);u&&u(t);while(h.length)h.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],s=!0,c=1;c<n.length;c++){var o=n[c];0!==r[o]&&(s=!1)}s&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var s={},r={app:0},a=[];function i(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=s,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=o;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var s=n("85ec"),r=n.n(s);r.a},"2e8e":function(e,t,n){"use strict";var s=n("4d1c"),r=n.n(s);r.a},"4d1c":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.error?n("div",[n("h2",{staticStyle:{color:"red"}},[e._v("Es gab einen Fehler beim Abrufen der Chatdaten:")]),n("h6",{staticStyle:{color:"red"}},[e._v(" "+e._s(e.error))])]):n("div",{attrs:{id:"app"}},[e.finished?n("Home"):n("custom-spinner")],1)},a=[],i=(n("ac1f"),n("1276"),n("5530")),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("Chat")],1)},o=[],l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.first||0===e.first,expression:"first || first === 0"}],attrs:{id:"chathistory"}},[n("div",{staticClass:"sticky"},[n("b-alert",{staticClass:"rounded-0 customalert",attrs:{fade:"",show:!e.connected,variant:"danger",id:"alert"}},[e._v("Keine Verbindung zum Internet. Nachrichten können nicht gesendet werden ")]),n("b-alert",{staticClass:"rounded-0 customalert",attrs:{fade:"",dismissible:"",show:"true",variant:"primary"}},[e._v(e._s("teacher"===e.user.role?"Durch einen Rechtsklick auf eine Nachricht (bzw. an Touchgeräten durch Gedrückthalten der Nachricht) können Sie diese aus dem Chat löschen":"Durch einen Rechtsklick auf eine Ihrer Nachrichten (bzw. an Touchgeräten durch Gedrückthalten der Nachricht) können Sie diese aus dem Chat löschen"))])],1),n("div",{staticClass:"customscroll",attrs:{id:"overflow"}},[e.first>0?n("b-button",{staticStyle:{width:"100%"},on:{click:e.revealOlder}},[e._v("Ältere Nachrichten")]):e._e(),n("transition-group",{attrs:{name:"chat"},on:{"after-enter":e.customScroll}},e._l(e.shortendMessages,(function(t){return n("chatmessage",{key:t.user+new Date(t.time).toISOString(),attrs:{id:t._id,user:e.user,message:t}})})),1)],1),n("chatsend-bar",{on:{send:e.send}})],1)},u=[],d=(n("fb6a"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.isSelf?"rightDiv":"leftDiv",on:{contextmenu:function(t){return e.handler(t)}}},[n("b-card",{staticClass:"message",attrs:{"no-body":""}},[e.isSelf?e._e():n("b-card-header",[n("p",{staticClass:"m-n2",staticStyle:{"font-size":"small"}},[e._v(e._s(e.userName))])]),n("b-card-body",[e.message.deleted?n("p",{staticClass:"m-n2 mt-n3 text-muted"},[n("i",[e._v("Diese Nachricht wurde gelöscht")])]):n("p",{staticClass:"m-n2 mt-n3"},[e._v(e._s(e.message.text))]),n("p",{staticClass:"mt-2 mb-n3 mr-n3 text-muted float-right"},[e._v(e._s(e.isToday(new Date(e.message.time))?"":e.date+", ")+" "+e._s(new Date(e.message.time).toLocaleTimeString()))])])],1)],1)}),h=[],f=(n("99af"),n("3835")),m=(n("4de4"),n("b0c0"),n("b85c")),g=n("16b2"),v=n("2f62");s["default"].use(v["a"]);var p,b=new v["a"].Store({state:{messages:null,scrollWithChat:!0,chatdata:null},mutations:{},actions:{},modules:{},getters:{messages:function(e){return e.messages},scrollWithChat:function(e){return e.scrollWithChat},user:function(e){return e.chatdata.user},chatdata:function(e){return e.chatdata},classlist:function(e){return e.chatdata.classlist},remoteCouch:function(e){return e.chatdata?"https://".concat(e.chatdata.dbuser,":").concat(e.chatdata.dbpassword,"@couch.kraeks.de/classroomchat_").concat(e.chatdata.classroom_uid):null}}});function w(){p=new g["a"](b.getters.remoteCouch),p.changes({since:"now",live:!0}).on("change",_)}function y(e){p.put(Object(i["a"])({},e,{_id:e.time.toISOString()+e.user}))}function _(){return p.allDocs({include_docs:!0,attachments:!0}).then((function(e){var t,n=[],s=Object(m["a"])(e.rows);try{for(s.s();!(t=s.n()).done;){var r=t.value;n.push(r.doc)}}catch(a){s.e(a)}finally{s.f()}b.state.messages=n}))}function C(e){var t=e.name,n=e.pin;return t+"_"+n}function O(e){var t=b.getters.classlist,n=t.filter((function(t){return C(t)===e}))[0];return n?n.name:"Unbekannt"}function S(e){y(Object(i["a"])({},e,{deleted:!0,time:new Date(e.time)}))}var k={name:"Chatmessage",props:{message:{type:Object,required:!0},user:{type:Object,required:!0}},computed:{isSelf:function(){return C(this.user)===this.message.user},userName:function(){return O(this.message.user)},date:function(){var e=new Date(this.message.time),t=new Intl.DateTimeFormat("en",{year:"numeric",month:"2-digit",day:"2-digit"}),n=t.formatToParts(e),s=Object(f["a"])(n,5),r=s[0].value,a=s[2].value,i=s[4].value;return"".concat(a,".").concat(r,".").concat(i)}},methods:{handler:function(e){var t=this;e.preventDefault(),!this.isSelf&&"teacher"!==this.user.role||this.message.deleted||this.$bvModal.msgBoxConfirm('Wollen sie die Nachricht "'.concat(this.message.text,'" wirklich löschen?'),{title:"Nachricht löschen?",okVariant:"danger",okTitle:"Löschen",cancelTitle:"Abbrechen",centered:!0}).then((function(e){e&&S(t.message)}))},isToday:function(e){var t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}}},j=k,x=(n("66d7"),n("2877")),M=Object(x["a"])(j,d,h,!1,null,"3e211c4a",null),D=M.exports,E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"senddiv"}},[n("b-form",{attrs:{inline:"",autocomplete:"off"},on:{submit:e.send}},[n("b-row",{staticStyle:{width:"100%"},attrs:{"align-v":"center"}},[n("b-col",{attrs:{cols:"8"}},[n("b-input",{staticStyle:{width:"100%"},attrs:{placeholder:"Nachricht senden"},model:{value:e.newMessage,callback:function(t){e.newMessage=t},expression:"newMessage"}})],1),n("b-col",{attrs:{cols:"4"}},[n("b-button",{staticStyle:{width:"100%"},attrs:{type:"submit",variant:"primary"}},[n("b-icon-cursor")],1)],1)],1)],1)],1)},I=[],T={name:"chatsendBar",data:function(){return{newMessage:""}},created:function(){},methods:{send:function(e){e.preventDefault(),""!==this.newMessage&&(this.$emit("send",this.newMessage),this.newMessage="")}}},N=T,$=(n("c28f"),Object(x["a"])(N,E,I,!1,null,"6b383cd4",null)),B=$.exports,W={name:"Chat",components:{ChatsendBar:B,Chatmessage:D},computed:Object(i["a"])({},Object(v["b"])(["messages","scrollWithChat","user"]),{shortendMessages:function(){return this.messages?this.messages.slice(this.first,this.messages.length):[]}}),mounted:function(){var e=this;window.addEventListener("online",(function(){e.connected=!0})),window.addEventListener("offline",(function(){e.connected=!1}));var t=0;document.getElementById("overflow").onscroll=function(e){var n=document.getElementById("overflow").scrollTop;n<=t?(e.preventDefault(),b.state.scrollWithChat=!1):b.state.scrollWithChat=window.innerHeight+window.pageYOffset>=document.body.offsetHeight,t=n<=0?0:n}},created:function(){var e=this;_().then((function(){e.first=e.messages.length-Math.min(e.messages.length,50),document.getElementById("overflow").scrollTo(0,4*document.getElementById("chathistory").scrollHeight),document.getElementById("senddiv").scrollIntoView({behavior:"smooth",block:"end"})}))},methods:{send:function(e){y({user:C(this.user),text:e,time:new Date})},customScroll:function(){0===this.reveal&&this.messages.length>7?document.getElementById(this.shortendMessages[this.shortendMessages.length-1]._id).scrollIntoView({behavior:"smooth",block:"start"}):this.reveal--},revealOlder:function(){var e=this.shortendMessages[0]._id;this.$store.state.scrollWithChat=!1,this.reveal=this.first<50?this.first:50,this.first=this.first<50?0:this.first-50,document.getElementById(e).scrollIntoView({block:"start"})}},data:function(){return{connected:!0,first:null,reveal:0}},watch:{scrollWithChat:function(e){0}}},P=W,H=(n("2e8e"),Object(x["a"])(P,l,u,!1,null,"5438c5d3",null)),L=H.exports,V={name:"Home",components:{Chat:L},data:function(){return{}}},z=V,F=Object(x["a"])(z,c,o,!1,null,null,null),q=F.exports,Y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"d-flex justify-content-center mt-3 mb-3"},[n("b-spinner",{attrs:{variant:e.variant,label:"Loading..."}})],1)},A=[],G={name:"CustomSpinner",props:{variant:{type:String,required:!1,default:"primary"}}},J=G,R=Object(x["a"])(J,Y,A,!1,null,null,null),K=R.exports,U=n("bc3a"),Q=n.n(U),X={components:{CustomSpinner:K,Home:q},created:function(){var e=this;Q.a.get("../classroomchat",{withCredentials:!0}).then((function(t){t.data.error?e.error=t.data.error:(e.$store.state.chatdata=t.data,w(),e.finished=!0)}))},data:function(){return{finished:!1,error:!1}},methods:{getCookie:function(e){for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var s=t[n];if(s=s.split("="),s[0]===e)return s[1]}return null}},computed:Object(i["a"])({},Object(v["b"])(["chatdata"]))},Z=X,ee=(n("034f"),Object(x["a"])(Z,r,a,!1,null,null,null)),te=ee.exports,ne=n("5f5b"),se=n("b1e0");n("944d");s["default"].use(ne["a"]),s["default"].use(se["a"]),s["default"].config.productionTip=!1,new s["default"]({store:b,render:function(e){return e(te)}}).$mount("#app")},"66d7":function(e,t,n){"use strict";var s=n("e2ad"),r=n.n(s);r.a},"85ec":function(e,t,n){},"944d":function(e,t,n){},bfc3:function(e,t,n){},c28f:function(e,t,n){"use strict";var s=n("bfc3"),r=n.n(s);r.a},e2ad:function(e,t,n){}});
//# sourceMappingURL=app.js.map